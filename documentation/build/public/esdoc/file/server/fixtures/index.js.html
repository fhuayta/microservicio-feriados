<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title data-ice="title">server/fixtures/index.js | Agetic BPM Feriados</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Api para obtener feriados del pais en general "><meta property="twitter:card" content="summary"><meta property="twitter:title" content="Agetic BPM Feriados"><meta property="twitter:description" content="Api para obtener feriados del pais en general "></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="../swagger"> Inicio </a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Referencias</a>
  <a href="source.html">C&#xF3;digo fuente</a>
  

  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a href="https://gitlab.geo.gob.bo/agetic/agetic-bpm-feriados">Repository</a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  </ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">server/fixtures/index.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">const debug = require(&apos;debug&apos;)(&apos;bpm:fixtures&apos;)
const mongoose = require(&apos;mongoose&apos;)
const path = require(&apos;path&apos;)
const {mongoUrl} = require(&apos;../config/config&apos;)
const inquirer = require(&apos;inquirer&apos;)
// const { exec } = require(&apos;child_process&apos;)
const prompt = inquirer.createPromptModule()
const{a&#xF1;os,feriados}=require(&apos;../fixtures/data/data&apos;)
const MongoClient = require(&apos;mongodb&apos;).MongoClient;

// Promesa para cargar los fixtures
function loadFixtures(xmongoUrl, fixtures_path) {
  return new Promise(async resolve =&gt; {
    const fixtures = await require(&apos;pow-mongodb-fixtures&apos;).connect(xmongoUrl)
    await fixtures.load(path.join(__dirname, fixtures_path), err =&gt; {
      if (err) {
        console.log(&apos;========================================_MENSAJE_A_MOSTRARSE_========================================&apos;)
        console.log(err);
        console.log(&apos;=====================================================================================================&apos;)
        throw &apos;Error al cargar fixtures&apos;
      } else {
        resolve()
      }
    })
    await MongoClient.connect(xmongoUrl, async function(err, client) {
      const nameDB = xmongoUrl.split(&apos;/&apos;).pop()
      const db = client.db(nameDB);
      await db.command( { create: &quot;feriados&quot;, viewOn: &quot;feriado&quot;, pipeline: feriados});
      await db.command( { create: &quot;years&quot;, viewOn: &quot;year&quot;, pipeline: years});
      client.close();
    });
  })
}

// Funcion para borrar y crear la base de datos
async function cleanDatabase (xmongoUrl){
    try {
      const conn = await mongoose.connect(xmongoUrl)
      await conn.connection.db.dropDatabase()
      const allModels = await require(&apos;../models/feriado&apos;)
      debug(&apos;Cargando Modelos de Schema: \n%o&apos;, allModels)
    } catch (error) {
      debug(&apos;No se puede establecer conexion con la base de datos&apos;, error) 
    }
}

// Funcion principal para cargar fixtures basado en la variable de entorno
// NODE_ENV en producion, development o test
async function start () {
  const node_env =  NODE_ENV
  if (node_env === &apos;production&apos; || node_env === &apos;development&apos;) {
    const answer = await prompt([{
      type: &apos;confirm&apos;,
      name: &apos;setup&apos;,
      message: &apos;Este proceso destruira tu base de datos, usted esta seguro?&apos;
    }])
    if (!answer.setup){
      return console.log(&apos;Accion cancelada&apos;)
    }
  }
  await cleanDatabase(mongoUrl)
  await loadFixtures(mongoUrl, &apos;data/&apos;)
  process.exit(0)
}

// El Proceso se esta ejecutando desde la terminal
if (!module.parent){
  start()
}

module.exports = start</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
